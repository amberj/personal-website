<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MongoDB / WiredTiger Corruption / Error: A Cautionary Tale of Adding MCP Servers to LibreChat - Amber&#x27;s Journal</title><meta name="description" content="MongoDB / WiredTiger Corruption: A Cautionary Tale of Adding MCP Servers to LibreChat"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="text/javascript" async src="https://www.googletagmanager.com/gtag/js?id=G-S0HV7M5FQ9"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', 'G-S0HV7M5FQ9' );</script><link rel="canonical" href="https://amberja.in/mongodb-wiredtiger-corruption-a-cautionary-tale-of-adding-mcp-servers-to-librechat.html"><link rel="alternate" type="application/atom+xml" href="https://amberja.in/feed.xml" title="Amber&#x27;s Journal - RSS"><link rel="alternate" type="application/json" href="https://amberja.in/feed.json" title="Amber&#x27;s Journal - JSON"><meta property="og:title" content="MongoDB / WiredTiger Corruption / Error: A Cautionary Tale of Adding MCP Servers to LibreChat"><meta property="og:image" content="https://amberja.in/media/posts/66/9aff2fb2-librechat.jpg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="800"><meta property="og:site_name" content="Amber's Journal"><meta property="og:description" content="MongoDB / WiredTiger Corruption: A Cautionary Tale of Adding MCP Servers to LibreChat"><meta property="og:url" content="https://amberja.in/mongodb-wiredtiger-corruption-a-cautionary-tale-of-adding-mcp-servers-to-librechat.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://amberja.in/media/website/favicon.png" type="image/png"><link rel="preload" href="https://amberja.in/assets/dynamic/fonts/publicsans/publicsans.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://amberja.in/assets/css/style.css?v=f3255e888ee4af56f3e8437a2c4c99f3"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://amberja.in/mongodb-wiredtiger-corruption-a-cautionary-tale-of-adding-mcp-servers-to-librechat.html"},"headline":"MongoDB / WiredTiger Corruption / Error: A Cautionary Tale of Adding MCP Servers to LibreChat","datePublished":"2025-12-30T22:25+05:30","dateModified":"2026-01-07T16:30+05:30","image":{"@type":"ImageObject","url":"https://amberja.in/media/posts/66/9aff2fb2-librechat.jpg","height":800,"width":1200},"description":"MongoDB / WiredTiger Corruption: A Cautionary Tale of Adding MCP Servers to LibreChat","author":{"@type":"Person","name":"Written by Amber Jain","url":"https://amberja.in/authors/amber-jain/"},"publisher":{"@type":"Organization","name":"Written by Amber Jain"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><style>.fi{fill:none;stroke-linecap:round;stroke-linejoin:round;vertical-align:middle}</style></head><body class="post-template"><div class="container"><div class="left-bar"><div class="left-bar__inner"><header class="header"><a class="logo" href="https://amberja.in/">Amber&#x27;s Journal</a><nav class="navbar"><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle__box"><span class="navbar__toggle__inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://amberja.in/" target="_self" aria-label="Home"><span>Home</span></a></li><li><a href="https://amberja.in/tags/blogpost/" target="_self" aria-label="Blog"><span>Blog</span></a></li><li><a href="https://amberja.in/quotes-i-like.html" target="_self" aria-label="Borrowed Wisdom"><span>Borrowed Wisdom</span></a></li><li><a href="https://amberja.in/tags/half-baked-explorations/" target="_self" aria-label="Half Baked Explorations"><span>Half Baked Explorations</span></a></li><li><a href="https://amberja.in/tags/linkmarks/" target="_self" aria-label="Linkmarks"><span>Linkmarks</span></a></li><li><a href="https://amberja.in/tags/exhibit-a/" target="_self" aria-label="Exhibit A"><span>Exhibit A</span></a></li><li><a href="https://amberja.in/tags/found-in-the-wild/" target="_self" aria-label="Found in the Wild"><span>Found in the Wild</span></a></li></ul></nav><a class="logo logo--atbottom" href="https://amberja.in/">Amber&#x27;s Journal</a></header></div></div><main class="main post"><article class="content"><figure class="content__featured-image content__featured-image--attop"><img src="https://amberja.in/media/posts/66/9aff2fb2-librechat.jpg" srcset="https://amberja.in/media/posts/66/responsive/9aff2fb2-librechat-xs.jpg 320w, https://amberja.in/media/posts/66/responsive/9aff2fb2-librechat-sm.jpg 480w, https://amberja.in/media/posts/66/responsive/9aff2fb2-librechat-md.jpg 768w, https://amberja.in/media/posts/66/responsive/9aff2fb2-librechat-xl.jpg 1024w" sizes="(min-width: 1460px) 938px, (min-width: 1200px) calc(75.83vw - 154px), (min-width: 1120px) 938px, (min-width: 900px) calc(55vw + 333px), 100vw" loading="eager" height="800" width="1200" alt="" aria-describedby="image-caption"></figure><div class="content__meta content__meta--attop"><div class="content__meta--attop__inner"><div class="content__maintag"><svg width="20" height="20" aria-hidden="true" focusable="false"><use xlink:href="https://amberja.in/assets/svg/svg-map.svg#tag"/></svg> Published in <a href="https://amberja.in/tags/ai-llms/" class="metadata__maintag">AI / LLMs</a> <span class="reading-time" aria-label="13 min read">13 min read</span></div></div></div><div class="main__inner"><div class="content__meta"><div class="content__date"><time datetime="2025-12-30T22:25">Dec 30, 2025</time></div></div><header class="content__header"><h1 class="content__title">MongoDB / WiredTiger Corruption / Error: A Cautionary Tale of Adding MCP Servers to LibreChat</h1></header><div class="content__entry"><p class="font-claude-response-body break-words whitespace-normal leading-[1.7] msg msg--highlight"><em>How a simple MCP config change crashed my entire LibreChat setup - twice</em></p><p>Sometimes the most frustrating bugs are the ones that punch you in the face twice before you learn to duck. I ran into a somewhat mysterious issue while trying to integrate the Pal MCP server (formerly known as Zen MCP server) into my local LibreChat install on my Macbook. What should have been a straightforward configuration change ended up corrupting MongoDB and taking down my entire local LLM infrastructure. Twice.¬†</p><p>In this blogpost, I will document how Pal MCP + LibreChat caused MongoDB to catastrophically fail - not once, but twice - and how I worked around it.</p><div class="post__toc"><h3>Table of Contents</h3><ul><li><a href="#mcetoc_1jdo6bmlq225">Context</a></li><li><a href="#mcetoc_1jdo6bmlq226">The Setup That Should Have Worked</a></li><li><a href="#mcetoc_1jdo6bmlq227">The Diagnosis ü©∫</a></li><li><a href="#mcetoc_1jdo6bmlq228">The Fix (Nuclear Option üí£)</a></li><li><a href="#toc_5">The Mystery Remains üïµüèª‚Äç‚ôÇÔ∏è</a></li><li><a href="#mcetoc_1jdo6bmlq229">The Problem</a></li><li><a href="#mcetoc_1jdo6bmlq22a">Solution</a></li><li><a href="#mcetoc_1jdo6bmlq22b">What's Next</a><ul><li><a href="#mcetoc_1jdo6bmlq22c">LibreChat's Chain of Agents</a></li><li><a href="#mcetoc_1jdo6bmlq22d">Pal MCP's Council of LLMs</a></li></ul></li></ul></div><h2 id="mcetoc_1jdo6bmlq225" class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Context</h2><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">I use <a href="https://librechat.ai/" target="_blank" rel="noopener noreferrer">LibreChat</a> as a core part of my LLM workflows. If you're not familiar with it, LibreChat is a self-hosted chat interface that lets you work with multiple LLM providers via it's integration with <a href="https://openrouter.ai/" target="_blank" rel="noopener noreferrer">Openrouter</a>. I run it via Docker Compose on my Mac, which spins up several containers including MongoDB for data persistence.</p><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">I also rely heavily on the <a href="https://github.com/BeehiveInnovations/pal-mcp-server" target="_blank" rel="noopener noreferrer">Pal MCP server</a> for "council of LLMs" - essentially getting multiple models to weigh in on problems, debate solutions, and reach consensus. It's become indispensable for complex reasoning tasks, especially for controversial topics - rangingfrom:</p><ul><li>the petty ones ("is a hot dog a sandwich?" or "is chocolate actually healthy?")</li><li>to contentious / polarizing / thornier questions like gun control policy, climate policy trade-offs, the ethics of capital punishment, whether military intervention can ever be justified, abortion rights, cryptocurrency regulation, immigration reforms or when (if ever) war is morally defensible.</li></ul><p>Having multiple models debate these issues surfaces blind spots and steelmans arguments I'd otherwise miss. When models disagree, I learn more than when they don't.</p><h2 id="mcetoc_1jdo6bmlq226" class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">The Setup That Should Have Worked</h2><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">I was trying to integrate the Pal MCP server (formerly known as Zen MCP server) into my LibreChat installation. The configuration seemed straightforward enough - just add the appropriate settings to <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">librechat.yaml</code> and restart the containers.</p><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">What could go wrong? Well, everything.</p><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">I added the Pal MCP server configuration to my <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">librechat.yaml</code>:</p><div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100">¬†</div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50"><pre class="language-yaml"><code>mcpServers:
  pal:
    command: sh
    args:
      - -c
      - "for p in $(which uvx 2&gt;/dev/null) $HOME/.local/bin/uvx /opt/homebrew/bin/uvx /usr/local/bin/uvx uvx; do [ -x \"$p\" ] &amp;&amp; exec \"$p\" --from git+https://github.com/BeehiveInnovations/pal-mcp-server.git pal-mcp-server; done; echo 'uvx not found' &gt;&amp;2; exit 1"
    env:
      PATH: "/usr/local/bin:/usr/bin:/bin:/opt/homebrew/bin:~/.local/bin"
      OPENROUTER_API_KEY: "&lt;INSERT_KEY_HERE&gt;"</code></pre></div></div></div></div></div><p class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">After updating the config and restarting the containers, MongoDB's Docker container refused to boot. The logs revealed something ugly:</p><pre class="language-apacheconf"><code>{"t":{"$date":"2025-12-23T19:01:11.620+00:00"},"s":"E",  "c":"WT",       "id":22435,   "ctx":"initandlisten","msg":"WiredTiger error message","attr":{"error":-31802,"message":{"ts_sec":1766516471,"ts_usec":620540,"thread":"1:0x7fb37d73e400","session_dhandle_name":"file:WiredTiger.wt","session_name":"connection","category":"WT_VERB_DEFAULT","log_id":1000000,"category_id":12,"verbose_level":"ERROR","verbose_level_id":-3,"msg":"__wti_block_read_off:308:WiredTiger.wt: fatal read error","error_str":"WT_ERROR: non-specific WiredTiger error","error_code":-31802}}}

{"t":{"$date":"2025-12-23T19:01:11.620+00:00"},"s":"E",  "c":"WT",       "id":22435,   "ctx":"initandlisten","msg":"WiredTiger error message","attr":{"error":-31804,"message":{"ts_sec":1766516471,"ts_usec":620606,"thread":"1:0x7fb37d73e400","session_dhandle_name":"file:WiredTiger.wt","session_name":"connection","category":"WT_VERB_DEFAULT","log_id":1000000,"category_id":12,"verbose_level":"ERROR","verbose_level_id":-3,"msg":"__wti_block_read_off:308:the process must exit and restart","error_str":"WT_PANIC: WiredTiger library panic","error_code":-31804}}}

{"t":{"$date":"2025-12-23T19:01:11.620+00:00"},"s":"F",  "c":"ASSERT",   "id":23089,   "ctx":"initandlisten","msg":"Fatal assertion","attr":{"msgid":50853,"location":"src/mongo/db/storage/wiredtiger/wiredtiger_util.cpp:644:9:int mongo::{anonymous}::mdb_handle_error_with_startup_suppression(WT_EVENT_HANDLER*, WT_SESSION*, int, const char*)"}}

{"t":{"$date":"2025-12-23T19:01:11.620+00:00"},"s":"F",  "c":"ASSERT",   "id":23090,   "ctx":"initandlisten","msg":"\n\n***aborting after fassert() failure\n\n"}

{"t":{"$date":"2025-12-23T19:01:11.620+00:00"},"s":"F",  "c":"CONTROL",  "id":6384300, "ctx":"initandlisten","msg":"Writing fatal message","attr":{"message":"Got signal: 6 (Aborted).\n"}}

{"t":{"$date":"2025-12-23T19:01:11.912+00:00"},"s":"I",  "c":"CONTROL",  "id":31380,   "ctx":"initandlisten","msg":"BACKTRACE","attr":{"bt":{"backtrace":[{"a":"563CE7A76D47","b":"563CDDB8E000","o":"9EE8D47","s":"_ZN5mongo15printStackTraceEv","C":"mongo::printStackTrace()","s+":"37"},{"a":"563CE7A55C45","b":"563CDDB8E000","o":"9EC7C45","s":"_ZN5mongo12_GLOBAL__N_115printErrorBlockEv","C":"mongo::(anonymous namespace)::printErrorBlock()","s+":"225"},{"a":"563CE7A55D55","b":"563CDDB8E000","o":"9EC7D55","s":"abruptQuit","s+":"85"},{"a":"7FB37E203330","b":"7FB37E1BE000","o":"45330"},{"a":"7FB37E25CB2C","b":"7FB37E1BE000","o":"9EB2C","s":"pthread_kill","s+":"11C"},{"a":"7FB37E20327E","b":"7FB37E1BE000","o":"4527E","s":"gsignal","s+":"1E"},{"a":"7FB37E1E68FF","b":"7FB37E1BE000","o":"288FF","s":"abort","s+":"DF"},{"a":"563CE7A43F70","b":"563CDDB8E000","o":"9EB5F70","s":"_ZN5mongo12_GLOBAL__N_19callAbortEv","C":"mongo::(anonymous namespace)::callAbort()","s+":"3C"},{"a":"563CE7A46631","b":"563CDDB8E000","o":"9EB8631","s":"_ZN5mongo14fassert_detail6failedENS0_5MsgIdENS_24WrappedStdSourceLocationE","C":"mongo::fassert_detail::failed(mongo::fassert_detail::MsgId, mongo::WrappedStdSourceLocation)","s+":"F9"},{"a":"563CE28D4FA5","b":"563CDDB8E000","o":"4D46FA5","s":"_ZN5mongo12_GLOBAL__N_141mdb_handle_error_with_startup_suppressionEP18__wt_event_handlerP12__wt_sessioniPKc.cold","C":"mongo::(anonymous namespace)::mdb_handle_error_with_startup_suppression(__wt_event_handler*, __wt_session*, int, char const*) [clone .cold]","s+":"11"},{"a":"563CE2A81E00","b":"563CDDB8E000","o":"4EF3E00","s":"__eventv","s+":"1310"},{"a":"563CE2A82284","b":"563CDDB8E000","o":"4EF4284","s":"__wt_panic_func","s+":"156"},{"a":"563CE28E86BD","b":"563CDDB8E000","o":"4D5A6BD","s":"__wti_block_read_off.cold","s+":"134"},{"a":"563CE2069C96","b":"563CDDB8E000","o":"44DBC96","s":"__wti_block_extlist_read","s+":"96"},{"a":"563CE28DF06F","b":"563CDDB8E000","o":"4D5106F","s":"__wti_block_checkpoint_extlist_dump","s+":"22F"},{"a":"563CE1E7410E","b":"563CDDB8E000","o":"42E610E","s":"__wti_block_read_off","s+":"3AE"},{"a":"563CE2069C96","b":"563CDDB8E000","o":"44DBC96","s":"__wti_block_extlist_read","s+":"96"},{"a":"563CE28E5ACB","b":"563CDDB8E000","o":"4D57ACB","s":"__wti_block_extlist_read_avail","s+":"2B"},{"a":"563CE28DE78C","b":"563CDDB8E000","o":"4D5078C","s":"__wt_block_checkpoint_load","s+":"2AC"},{"a":"563CE28F45D9","b":"563CDDB8E000","o":"4D665D9","s":"__bm_checkpoint_load","s+":"39"},{"a":"563CE291279B","b":"563CDDB8E000","o":"4D8479B","s":"__wt_btree_open","s+":"E6B"},{"a":"563CE297D609","b":"563CDDB8E000","o":"4DEF609","s":"__wt_conn_dhandle_open","s+":"379"},{"a":"563CE1FE2298","b":"563CDDB8E000","o":"4454298","s":"__wt_session_get_dhandle","s+":"C8"},{"a":"563CE1FE267A","b":"563CDDB8E000","o":"445467A","s":"__wt_session_get_dhandle","s+":"4AA"},{"a":"563CE1FE2157","b":"563CDDB8E000","o":"4454157","s":"__wt_session_get_btree_ckpt","s+":"7C7"},{"a":"563CE1E10C57","b":"563CDDB8E000","o":"4282C57","s":"__wt_curfile_open","s+":"177"},{"a":"563CE2A6CB59","b":"563CDDB8E000","o":"4EDEB59","s":"__session_open_cursor_int","s+":"599"},{"a":"563CE1E3D536","b":"563CDDB8E000","o":"42AF536","s":"__wt_open_cursor","s+":"56"},{"a":"563CE1F943D0","b":"563CDDB8E000","o":"44063D0","s":"__wt_metadata_cursor_open","s+":"70"},{"a":"563CE1F65869","b":"563CDDB8E000","o":"43D7869","s":"__wt_metadata_cursor","s+":"49"},{"a":"563CE29773A8","b":"563CDDB8E000","o":"4DE93A8","s":"wiredtiger_open","s+":"1EE8"},{"a":"563CE289FFC9","b":"563CDDB8E000","o":"4D11FC9","s":"_ZN5mongo18WiredTigerKVEngine15_openWiredTigerERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES8_","C":"mongo::WiredTigerKVEngine::_openWiredTiger(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;)","s+":"79"},{"a":"563CE28ACC12","b":"563CDDB8E000","o":"4D1EC12","s":"_ZN5mongo18WiredTigerKVEngineC1ERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES8_PNS_11ClockSourceENS_22WiredTigerKVEngineBase16WiredTigerConfigERKNS_20WiredTigerExtensionsEbbbb","C":"mongo::WiredTigerKVEngine::WiredTigerKVEngine(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;, mongo::ClockSource*, mongo::WiredTigerKVEngineBase::WiredTigerConfig, mongo::WiredTigerExtensions const&amp;, bool, bool, bool, bool)","s+":"812"},{"a":"563CE285B81A","b":"563CDDB8E000","o":"4CCD81A","s":"_ZNK5mongo12_GLOBAL__N_117WiredTigerFactory6createEPNS_16OperationContextERKNS_19StorageGlobalParamsEPKNS_21StorageEngineLockFileEbbb","C":"mongo::(anonymous namespace)::WiredTigerFactory::create(mongo::OperationContext*, mongo::StorageGlobalParams const&amp;, mongo::StorageEngineLockFile const*, bool, bool, bool) const","s+":"2DA"},{"a":"563CE3D9960C","b":"563CDDB8E000","o":"620B60C","s":"_ZN5mongo23initializeStorageEngineEPNS_16OperationContextENS_22StorageEngineInitFlagsEbbbPNS_14BSONObjBuilderE","C":"mongo::initializeStorageEngine(mongo::OperationContext*, mongo::StorageEngineInitFlags, bool, bool, bool, mongo::BSONObjBuilder*)","s+":"44C"},{"a":"563CE3D42477","b":"563CDDB8E000","o":"61B4477","s":"_ZN5mongo7catalog40startUpStorageEngineAndCollectionCatalogEPNS_14ServiceContextEPNS_6ClientENS_22StorageEngineInitFlagsEPNS_14BSONObjBuilderE","C":"mongo::catalog::startUpStorageEngineAndCollectionCatalog(mongo::ServiceContext*, mongo::Client*, mongo::StorageEngineInitFlags, mongo::BSONObjBuilder*)","s+":"E7"},{"a":"563CE20B7B96","b":"563CDDB8E000","o":"4529B96","s":"_ZN5mongo12_GLOBAL__N_114_initAndListenEPNS_14ServiceContextE","C":"mongo::(anonymous namespace)::_initAndListen(mongo::ServiceContext*)","s+":"6D6"},{"a":"563CE20BA092","b":"563CDDB8E000","o":"452C092","s":"_ZN5mongo12_GLOBAL__N_113initAndListenEPNS_14ServiceContextE","C":"mongo::(anonymous namespace)::initAndListen(mongo::ServiceContext*)","s+":"22"},{"a":"563CE20BF78E","b":"563CDDB8E000","o":"453178E","s":"_ZN5mongo11mongod_mainEiPPc","C":"mongo::mongod_main(int, char**)","s+":"E1E"},{"a":"563CE20A80E7","b":"563CDDB8E000","o":"451A0E7","s":"main","s+":"9"},{"a":"7FB37E1E81CA","b":"7FB37E1BE000","o":"2A1CA"},{"a":"7FB37E1E828B","b":"7FB37E1BE000","o":"2A28B","s":"__libc_start_main","s+":"8B"},{"a":"563CE20A7FC5","b":"563CDDB8E000","o":"4519FC5","s":"_start","s+":"25"}],"processInfo":{"mongodbVersion":"8.2.2","gitVersion":"594f839ceec1f4385be9a690131412d67b249a0a","compiledModules":[],"uname":{"sysname":"Linux","release":"6.12.54-linuxkit","version":"#1 SMP PREEMPT_DYNAMIC Tue Nov  4 21:39:03 UTC 2025","machine":"x86_64"},"somap":[{"b":"563CDDB8E000","path":"/usr/bin/mongod","elfType":3,"buildId":"9EE04132F3F41053B388D9BA9B3762DCB713C1A4"},{"b":"7FB37E1BE000","path":"/lib/x86_64-linux-gnu/libc.so.6","elfType":3,"buildId":"274EEC488D230825A136FA9C4D85370FED7A0A5E"}]}}},"tags":[]}

{"t":{"$date":"2025-12-23T19:01:11.912+00:00"},"s":"I",  "c":"CONTROL",  "id":31445,   "ctx":"initandlisten","msg":"Frame","attr":{"frame":{"a":"563CE7A76D47","b":"563CDDB8E000","o":"9EE8D47","s":"_ZN5mongo15printStackTraceEv","C":"mongo::printStackTrace()","s+":"37"}}}

{"t":{"$date":"2025-12-23T19:01:11.912+00:00"},"s":"I",  "c":"CONTROL",  "id":31445,   "ctx":"initandlisten","msg":"Frame","attr":{"frame":{"a":"563CE7A55C45","b":"563CDDB8E000","o":"9EC7C45","s":"_ZN5mongo12_GLOBAL__N_115printErrorBlockEv","C":"mongo::(anonymous namespace)::printErrorBlock()","s+":"225"}}}

{"t":{"$date":"2025-12-23T19:01:11.912+00:00"},"s":"I",  "c":"CONTROL",  "id":31445,   "ctx":"initandlisten","msg":"Frame","attr":{"frame":{"a":"563CE7A55D55","b":"563CDDB8E000","o":"9EC7D55","s":"abruptQuit","s+":"85"}}}

{"t":{"$date":"2025-12-23T19:01:11.912+00:00"},"s":"I",  "c":"CONTROL",  "id":31445,   "ctx":"initandlisten","msg":"Frame","attr":{"frame":{"a":"7FB37E203330","b":"7FB37E1BE000","o":"45330"}}}

{"t":{"$date":"2025-12-23T19:01:11.912+00:00"},"s":"I",  "c":"CONTROL",  "id":31445,   "ctx":"initandlisten","msg":"Frame","attr":{"frame":{"a":"7FB37E25CB2C","b":"7FB37E1BE000","o":"9EB2C","s":"pthread_kill","s+":"11C"}}}

{"t":{"$date":"2025-12-23T19:01:11.912+00:00"},"s":"I",  "c":"CONTROL",  "id":31445,   "ctx":"initandlisten","msg":"Frame","attr":{"frame":{"a":"7FB37E20327E","b":"7FB37E1BE000","o":"4527E","s":"gsignal","s+":"1E"}}}</code></pre><h2 id="mcetoc_1jdo6bmlq227">The Diagnosis ü©∫</h2><p>After feeding the logs to Claude, the verdict was clear: WiredTiger storage engine corruption causing MongoDB to crash with a segmentation fault (error code 139).<br><br>The key errors in the logs were:</p><blockquote><p>This is a WiredTiger storage engine corruption issue causing MongoDB to crash. Error code 139 indicates a segmentation fault (SIGSEGV). The key error is: WT_PANIC: WiredTiger library panic</p><p>fatal read error on WiredTiger.wt</p><p>the process must exit and restart</p></blockquote><p>WiredTiger is MongoDB's default storage engine, and when it panics like this, your data is <em><strong>likely</strong></em> compromised. The corruption was severe enough that MongoDB container was stuck in a bootloop.</p><h2 id="mcetoc_1jdo6bmlq228" class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">The Fix (Nuclear Option üí£)</h2><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Warning: This solution causes data loss. Back up everything first if you have any hope of recovery.</strong></p><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Since the database was corrupted beyond repair, I had to nuke everything and start fresh:</p><p class="msg msg--warning">DANGER AHEAD! PROCEED WITH CAUTION</p><pre class="language-bash"><code># Stop all containers and remove volumes
docker-compose down -v

# Remove orphaned volumes
docker volume prune -f

# Check what's left
docker volume ls

# The nuclear option - removes everything
docker system prune -a --volumes</code></pre><p>That last command is particularly destructive. It removes:</p><ul><li>all stopped containers</li><li>all networks not used by at least one container</li><li>all anonymous volumes not used by at least one container</li><li>all images without at least one container associated to them</li><li>all build cache</li></ul><p>After the purge, I rebuilt everything from scratch:</p><div><pre class="language-bash"><code>docker compose up -d</code></pre><p>LibreChat came back up with a fresh MongoDB instance. All my chat history was gone, but at least it was working.</p><h2 id="toc_5">The Mystery Remains üïµüèª‚Äç‚ôÇÔ∏è</h2><p>Here's the frustrating part: I still don't know <em>why</em> adding the Pal MCP server configuration corrupted MongoDB. My common sense tells me that the config change shouldn't have touched the database at all.¬†</p><p>The fact that it happened twice with the same config change suggests it's not random, but I haven't been able to pin down the root cause (yet!).</p><p>Here's what Sonnet 4.5 told me to try (which I haven't tried yet):</p><blockquote><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">The issue is with your PAL MCP server configuration - specifically the <strong>shell command and path handling</strong>. The complex shell script is likely causing resource issues or hanging during startup, which is blocking MongoDB initialization.</p><h2 id="mcetoc_1jdo6bmlq229" class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">The Problem</h2><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Your PAL MCP config uses a shell loop that:</p><ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3"><li class="whitespace-normal break-words pl-2">Searches multiple paths for <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">uvx</code></li><li class="whitespace-normal break-words pl-2">Clones and installs from git</li><li class="whitespace-normal break-words pl-2">Has <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">~/.local/bin</code> in PATH (tilde expansion doesn't work in Docker)</li></ol><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">This is probably timing out or consuming resources during container startup, preventing MongoDB from initializing properly.</p><h2 id="mcetoc_1jdo6bmlq22a" class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Solution</h2><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Replace your PAL MCP configuration with a simpler, Docker-friendly approach:</p><pre class="language-yaml"><code>mcpServers:
  pal:
    command: uvx
    args:
      - --from
      - git+https://github.com/BeehiveInnovations/pal-mcp-server.git
      - pal-mcp-server
    env:
      OPENROUTER_API_KEY: "&lt;INSERT_KEY_HERE&gt;"</code></pre><p>¬†</p></blockquote><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">¬†</p><h2 id="mcetoc_1jdo6bmlq22b" class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">What's Next</h2><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">I'm now back to square one: LibreChat running without the Pal MCP integration. Both tools are essential to my workflow:</p><h3 id="mcetoc_1jdo6bmlq22c" class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>LibreChat's Chain of Agents</strong></h3><p>I also depend heavily on LibreChat's no-code <a href="https://www.librechat.ai/docs/features/agents#agent-chain" target="_blank" rel="noopener noreferrer">Agent Chain</a> - Think <a href="https://en.wikipedia.org/wiki/Pipeline_(Unix)" target="_blank" rel="noopener noreferrer">Unix pipes</a>, but for LLMs! But in this case, think of each prompt-model combo as a Unix command doing one job. LibreChat's <em>Agent Chain</em> is just the pipe between them - carrying output from one prompt to the next.</p><p>In other words: Agent chain is a no-code pipeline of multiple prompts, where each prompt¬† does one thing and does it well (via a specific LLM model that specializes for that task), and hands off it's output to the next...¬†</p><blockquote><p>In <a href="https://en.wikipedia.org/wiki/Unix_philosophy#Origin" target="_blank" rel="noopener noreferrer">Unix Philosophy</a>: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">cat file.txt | transform | format</code> chains commands via pipes.</p><p>In LibreChat: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">extraction prompt (via gpt5.2) ‚Üí analyze (via sonnet 4.5) ‚Üí summarize (via gemini 3.5 pro)</code> chains prompt-model combos via the agent chain.</p></blockquote><h3 id="mcetoc_1jdo6bmlq22d" class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Pal MCP's Council of LLMs</strong></h3><p>For complex decisions, I want multiple models with different perspectives to analyze the problem. Pal MCP makes this possible by orchestrating multi-model consensus.</p><p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">I have updated this post with instructions to safely add Pal MCP to LibreChat without corrupting everything. <span style="text-decoration: line-through;">If you've successfully integrated these two tools, I'd love to hear how you did it.</span></p><p><span style="text-decoration: line-through;">Have you experienced similar issues with LibreChat, MCP servers, or MongoDB in Docker?¬† Reach out - I'm curious if this is a known issue or if I'm just uniquely unlucky.</span></p><p><span style="text-decoration: line-through;">I might (or might not) update this blog post if and when I figure out how to configure Pal MCP inside LibreChat. For now, they run separately; Pal MCP in Claude code, and my MongoDB sleeps peacefully.</span></p><h2>How to get Pal MCP working in librachat:</h2><p>This is how my bare minimal <code>librechat.yaml</code> looks like (feel free to remove parts that you dont need). Make sure to replace <code>&lt;INSERT_OPENROUTER_KEY_HERE&gt;</code> with your Openrouter API key:</p><pre class="language-yaml"><code>version: 1.2.8
cache: true
endpoints:
  agents:
    recursionLimit: 100        # increase default agent steps to 50
    maxRecursionLimit: 500    # allow up to 100 if adjusting via UI
  custom:
    - name: "OpenRouter"
      apiKey: "&lt;INSERT_OPENROUTER_KEY_HERE&gt;"
      baseURL: "https://openrouter.ai/api/v1"
      models:
        default: ["gpt-3.5-turbo"]
        fetch: true
      titleConvo: true
      titleModel: "current_model"
      summarize: false
      summaryModel: "current_model"
      forcePrompt: false
      modelDisplayLabel: "OpenRouter"
mcpServers:
  memory:
    command: npx
    args:
      - -y
      - "@modelcontextprotocol/server-memory"
  pal:
    command: uvx
    args:
      - --from
      - git+https://github.com/BeehiveInnovations/pal-mcp-server.git
      - pal-mcp-server
    env:
      OPENROUTER_API_KEY: "&lt;INSERT_OPENROUTER_KEY_HERE&gt;"</code></pre><p>The snippet for <span style="font-size: inherit;"><code>maxRecursionLimit</code> and <code>recursionLimit</code> </span><span style="font-size: inherit;">is to fix if you get this error (Click <a href="https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/agents" target="_blank" rel="noopener noreferrer">here</a> and <a href="https://www.librechat.ai/docs/features/agents#max-agent-steps" target="_blank" rel="noopener noreferrer">here</a> for more info):</span></p><p class="msg msg--warning">Something went wrong. Here's the specific error message we encountered: An error occurred while processing the request: Recursion limit of 25 reached without hitting a stop condition. You can increase the limit by setting the "recursionLimit" config key. Troubleshooting URL: https://langchain-ai.github.io/langgraphjs/troubleshooting/errors/GRAPH_RECURSION_LIMIT/¬†</p><p>¬†</p><p>And this is my docker-compose.override.yml :</p><pre class="language-yaml"><code>services:
  api:
    volumes:
      - type: bind
        source: ./librechat.yaml
        target: /app/librechat.yaml
    command: sh -c "apk add --no-cache git &amp;&amp; pip install --break-system-packages uv &amp;&amp; npm run backend"</code></pre></div></div><footer class="content__footer"><div class="content__last-updated">This article was updated on <time datetime="2026-01-07T16:30">Jan 7, 2026</time></div><div class="content__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Famberja.in%2Fmongodb-wiredtiger-corruption-a-cautionary-tale-of-adding-mcp-servers-to-librechat.html" class="js-share facebook tltp tltp--top" aria-label="Facebook" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://amberja.in/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Famberja.in%2Fmongodb-wiredtiger-corruption-a-cautionary-tale-of-adding-mcp-servers-to-librechat.html&amp;via=amberja_in&amp;text=MongoDB%20%2F%20WiredTiger%20Corruption%20%2F%20Error%3A%20A%20Cautionary%20Tale%20of%20Adding%20MCP%20Servers%20to%20LibreChat" class="js-share twitter tltp tltp--top" aria-label="Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://amberja.in/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Famberja.in%2Fmongodb-wiredtiger-corruption-a-cautionary-tale-of-adding-mcp-servers-to-librechat.html" class="js-share linkedin tltp tltp--top" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://amberja.in/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://api.whatsapp.com/send?text=MongoDB%20%2F%20WiredTiger%20Corruption%20%2F%20Error%3A%20A%20Cautionary%20Tale%20of%20Adding%20MCP%20Servers%20to%20LibreChat https%3A%2F%2Famberja.in%2Fmongodb-wiredtiger-corruption-a-cautionary-tale-of-adding-mcp-servers-to-librechat.html" class="js-share whatsapp tltp tltp--top" title="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://amberja.in/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div></footer></div></article><div class="content__section post__related"><div class="main__inner"><h3 class="content__section__title">Related post</h3><div class="post__related__wrap"><article class="c-card"><div class="c-card__meta"><div class="c-card__author"><a href="https://amberja.in/authors/amber-jain/">Written by Amber Jain</a></div><time datetime="2025-07-09T20:39">Jul 9, 2025 </time><a href="https://amberja.in/tags/ai-llms/" class="c-card-tag">AI / LLMs</a></div><a href="https://amberja.in/adding-mcp-servers-to-claude-code.html" class="c-card__image"><img src="https://amberja.in/media/posts/6/ec726680e57b03bc40e8c5e58a848e7cd39a15df-2881x1621.webp" srcset="https://amberja.in/media/posts/6/responsive/ec726680e57b03bc40e8c5e58a848e7cd39a15df-2881x1621-xs.webp 320w, https://amberja.in/media/posts/6/responsive/ec726680e57b03bc40e8c5e58a848e7cd39a15df-2881x1621-sm.webp 480w" sizes="(min-width: 700px) 200px, (min-width: 480px) 160px, calc(100vw - 50px)" loading="lazy" height="1621" width="2881" alt=""></a><header class="c-card__header"><h2 class="c-card__title"><a href="https://amberja.in/adding-mcp-servers-to-claude-code.html">Adding MCP servers to Claude Code</a></h2><p>Introduction Anthropic‚Äôs Documentation: https://docs.anthropic.com/en/docs/claude-code/mcp List on Github (sorted by stars?) Handy command:&hellip;</p></header></article></div></div></div></main><div class="right-bar"><div class="right-bar__inner"><div class="sidebar"><section class="box featured"><h3 class="box__title">Featured Posts</h3><ul class="featured__container"><li class="featured__item"><a href="https://amberja.in/linkedin-growth.html" class="featured__image"><img src="https://amberja.in/media/posts/8/LinkedIn-marketing-the-complete-guide-to-boost-your-strategy-Final.svg" loading="lazy" alt="Linkedin" height="440" width="440"></a><div><a href="https://amberja.in/linkedin-growth.html" class="featured__title">Growing your organic reach on LinkedIn</a></div></li></ul></section><section class="box tags"><h3 class="box__title">Recommended Topics</h3><ul class="tags__list"><li class="tags__item"><a href="https://amberja.in/tags/ai-llms/" class="btn btn--gray">AI / LLMs <sup>(15)</sup></a></li><li class="tags__item"><a href="https://amberja.in/tags/android/" class="btn btn--gray">Android <sup>(1)</sup></a></li><li class="tags__item"><a href="https://amberja.in/tags/blogpost/" class="btn btn--gray">Blogposts <sup>(13)</sup></a></li><li class="tags__item"><a href="https://amberja.in/tags/exhibit-a/" class="btn btn--gray">Exhibit A <sup>(1)</sup></a></li><li class="tags__item"><a href="https://amberja.in/tags/found-in-the-wild/" class="btn btn--gray">Found in the Wild <sup>(1)</sup></a></li><li class="tags__item"><a href="https://amberja.in/tags/growth/" class="btn btn--gray">Growth / Marketing <sup>(2)</sup></a></li><li class="tags__item"><a href="https://amberja.in/tags/half-baked-explorations/" class="btn btn--gray">Half Baked Explorations <sup>(4)</sup></a></li><li class="tags__item"><a href="https://amberja.in/tags/linkmarks/" class="btn btn--gray">Linkmarks <sup>(3)</sup></a></li><li class="tags__item"><a href="https://amberja.in/tags/my-personal-setup/" class="btn btn--gray">My Personal Setup <sup>(3)</sup></a></li><li class="tags__item"><a href="https://amberja.in/tags/tech-and-programming/" class="btn btn--gray">Tech &amp; Programming <sup>(13)</sup></a></li></ul></section><div class="box follow"><a href="https://x.com/amberja_in" class="tltp tltp--top" aria-label="Twitter"><svg><use xlink:href="https://amberja.in/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://www.instagram.com/jain_amber/" class="tltp tltp--top" aria-label="Instagram"><svg><use xlink:href="https://amberja.in/assets/svg/svg-map.svg#instagram"/></svg> <span>Instagram</span> </a><a href="https://www.linkedin.com/in/amberjain/" class="tltp tltp--top" aria-label="LinkedIn"><svg><use xlink:href="https://amberja.in/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span></a></div><div class="box copyright">Copyright ¬© 2025 Amber Jain</div></div></div></div></div><script defer="defer" src="https://amberja.in/assets/js/scripts.min.js?v=b2d91bcadbf5db401b76eb5bb3092eb7"></script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>